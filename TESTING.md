# 🧪 前端测试指南

## 快速开始（3分钟）

### 1. 启动测试服务器
```bash
cd /mnt/d/recipe/recipe-miniapp

# 确保安装了依赖
npm install express cors

# 启动测试服务器
node test-server.js
```

看到以下输出表示启动成功：
```
🧪 菜谱小程序前端测试服务器已启动
地址: http://localhost:3999/api
```

### 2. 配置微信小程序

编辑 `wechat-app/app.js`，修改 `apiBaseUrl`：
```javascript
globalData: {
  apiBaseUrl: 'http://localhost:3999/api',  // 改成测试服务器地址
  // ...
}
```

### 3. 微信开发者工具设置

1. 打开微信开发者工具
2. 导入 `wechat-app` 项目
3. 点击「详情」→「本地设置」
4. ✅ 勾选「不校验合法域名、web-view...」

### 4. 开始测试

点击「编译」，即可看到小程序运行！

---

## 📱 真机测试（手机预览）

### 方法一：内网访问（推荐）

1. **获取电脑IP地址**
   ```bash
   # Mac/Linux
   ifconfig | grep "inet "
   
   # Windows
   ipconfig
   ```
   找到类似 `192.168.1.xxx` 的地址

2. **修改测试服务器监听地址**
   编辑 `test-server.js`，把最后一行改为：
   ```javascript
   app.listen(PORT, '0.0.0.0', () => { ... })
   ```

3. **修改小程序 API 地址**
   ```javascript
   apiBaseUrl: 'http://192.168.1.xxx:3999/api'
   ```

4. **手机连接同一 WiFi**，然后扫码预览

### 方法二：内网穿透

使用 ngrok 或花生壳等工具：
```bash
# 安装 ngrok
npm install -g ngrok

# 启动穿透（将本地 3999 端口暴露到公网）
ngrok http 3999
```

然后把生成的公网地址填入小程序配置。

---

## ✅ 测试 checklist

### 首页
- [ ] 正常显示问候语和用户名
- [ ] 显示"3道新菜谱"徽章
- [ ] 点击搜索栏跳转搜索页
- [ ] 菜系筛选标签可点击切换
- [ ] 收藏的菜谱列表正常显示
- [ ] 点击菜谱卡片跳转详情页
- [ ] 点击心形取消收藏

### 市场页
- [ ] 显示"今日新增X道菜谱"提示
- [ ] 菜谱网格布局正确
- [ ] 点击菜谱跳转详情
- [ ] 点击收藏按钮收藏成功
- [ ] 收藏后该菜谱从市场消失

### 推荐页
- [ ] 显示今日日期
- [ ] 显示3道推荐菜谱
- [ ] 第一个推荐显示"今日首选"标签
- [ ] 食材预览正确显示
- [ ] 收藏/取消收藏功能正常
- [ ] 换一批推荐按钮可用

### 个人中心
- [ ] 用户头像和昵称显示正确
- [ ] 统计数字（菜谱数、菜系数）正确
- [ ] 点击偏好设置跳转设置页
- [ ] 关于我们和意见反馈可点击

### 偏好设置
- [ ] 显示当前已选择的菜系
- [ ] 点击菜系可选中/取消
- [ ] 点击已选标签可移除
- [ ] 保存设置成功提示

### 搜索页
- [ ] 输入关键词实时搜索
- [ ] 搜索历史显示和点击
- [ ] 热门搜索可点击
- [ ] 搜索结果正确显示
- [ ] 点击结果跳转详情

### 菜谱详情
- [ ] 大图展示正常
- [ ] 食材清单完整显示
- [ ] 步骤列表带序号显示
- [ ] 收藏按钮可点击
- [ ] 分享功能正常

---

## 🔧 常见问题

### 1. 提示"未能连接到服务器"
- 检查测试服务器是否运行（`node test-server.js`）
- 检查 `apiBaseUrl` 配置是否正确
- 检查微信开发者工具是否勾选「不校验合法域名」

### 2. 真机测试无法连接
- 确保手机和电脑在同一 WiFi
- 检查防火墙是否开放 3999 端口
- 使用电脑 IP 而非 localhost

### 3. 数据显示异常
- 打开微信开发者工具「调试器」
- 查看 Console 面板的报错信息
- 检查 Network 面板的 API 请求是否成功

---

## 📝 测试数据说明

测试服务器内置了5道示例菜谱：
- 麻婆豆腐（川菜）
- 剁椒鱼头（湘菜）
- 番茄炒蛋（家常菜）
- 红烧肉（家常菜）
- 糖醋排骨（家常菜）

以及一个测试用户，默认收藏了前3道。

---

## 🐛 调试技巧

### 查看 API 请求
在微信开发者工具：
1. 打开「调试器」
2. 切换到「Network」面板
3. 查看 API 请求和响应

### 模拟不同用户
修改 `test-server.js` 中的 `mockUser` 数据，重启服务器即可。

### 添加更多测试数据
在 `mockRecipes` 数组中添加更多菜谱对象。

---

## 🎉 测试通过标准

- ✅ 所有页面能正常打开
- ✅ 所有按钮能正常点击
- ✅ 数据加载和显示正确
- ✅ 收藏/取消收藏功能正常
- ✅ 页面切换流畅无卡顿
- ✅ 没有明显的样式问题

测试完成后，记得：
1. 把 `apiBaseUrl` 改回真实后端地址
2. 在小程序后台配置服务器域名
3. 提交代码审核
